{% extends "base.html" %}
{% load contracts_extras %}
{% load static %}

{% block page_title %}Home{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'contracts/css/contracts.css' %}">
<style>
.dashboard-container {
    padding: 1.5rem 2rem;
}

/* Welcome Section */
.welcome-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.welcome-content {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

.welcome-icon {
    width: 40px;
    height: 40px;
    background: rgba(46, 204, 113, 0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-green);
    font-size: 1.25rem;
}

.welcome-text h1 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.25rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.welcome-text p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0;
}

.btn-new-contract {
    background: var(--primary-green);
    color: white;
    border: none;
    padding: 0.625rem 1.25rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    transition: all 0.2s;
}

.btn-new-contract:hover {
    background: var(--primary-green-dark);
    color: white;
}

/* Stats Cards Row */
.stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: white;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    color: inherit;
}

.stat-card:hover {
    border-color: var(--primary-green);
}

.stat-card.active {
    border-color: var(--primary-green);
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.05) 0%, rgba(46, 204, 113, 0.02) 100%);
}

.stat-content {
    display: flex;
    flex-direction: column;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-card.active .stat-number {
    color: var(--primary-green);
}

.stat-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.125rem;
}

.stat-subtitle {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.stat-icon {
    width: 40px;
    height: 40px;
    background: var(--bg-main);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    font-size: 1.125rem;
}

.stat-card.active .stat-icon {
    background: rgba(46, 204, 113, 0.15);
    color: var(--primary-green);
}

/* Main Content Grid */
.content-grid {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 1.5rem;
}

/* Content Card */
.content-card {
    background: white;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    overflow: hidden;
}

.content-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border-color);
}

.content-card-header h3 {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.view-all-link {
    font-size: 0.8125rem;
    color: var(--primary-green);
    text-decoration: none;
    font-weight: 500;
}

.view-all-link:hover {
    text-decoration: underline;
}

.content-card-body {
    padding: 2rem 1.25rem;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.empty-state-text {
    color: var(--text-secondary);
    font-size: 0.9375rem;
}

.content-card-footer {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 0.75rem 1.25rem;
    border-top: 1px solid var(--border-color);
}

.pagination-link {
    font-size: 0.8125rem;
    color: var(--primary-green);
    text-decoration: none;
    font-weight: 500;
}

.pagination-link:hover {
    text-decoration: underline;
}

/* Illustration Card */
.illustration-card {
    background: white;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    padding: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
}

.illustration-placeholder {
    text-align: center;
}

.illustration-placeholder svg {
    width: 200px;
    height: auto;
    opacity: 0.9;
}

/* Contract Status Section */
.status-section {
    margin-top: 1.5rem;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

.status-card {
    background: white;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    padding: 1.25rem;
}

.status-card h4 {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 1rem 0;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.status-item:last-child {
    border-bottom: none;
}

.status-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8125rem;
    color: var(--text-secondary);
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.status-dot.draft { background: #95a5a6; }
.status-dot.pending { background: #f39c12; }
.status-dot.active { background: #2ecc71; }
.status-dot.expired { background: #e74c3c; }
.status-dot.terminated { background: #9b59b6; }
.status-dot.archived { background: #34495e; }

.status-count {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.875rem;
}

.status-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0 0;
    margin-top: 0.5rem;
    border-top: 2px solid var(--border-color);
}

.status-total .status-label {
    font-weight: 600;
    color: var(--text-primary);
}

.status-total .status-count {
    font-size: 1rem;
}

@media (max-width: 1200px) {
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .status-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .stats-row {
        grid-template-columns: 1fr;
    }
    
    .welcome-section {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <div class="welcome-content">
            <div class="welcome-icon">
                <i class="bi bi-house-door"></i>
            </div>
            <div class="welcome-text">
                <h1>
                    Welcome{% if user.first_name %}, {{ user.first_name }}{% endif %}! ðŸ“‹
                </h1>
                <p>Let's get you caught up with items that need your attention.</p>
            </div>
        </div>
        {% if can_create %}
        <a href="{% url 'contracts:create' %}?reset=1" class="btn-new-contract">
            <i class="bi bi-plus"></i> New Contract
        </a>
        {% endif %}
    </div>
    
    <!-- Stats Cards -->
    <div class="stats-row">
        <a href="{% url 'contracts:list' %}?tab=pending" class="stat-card active">
            <div class="stat-content">
                <div class="stat-number">{{ pending_action.count|default:0 }}</div>
                <div class="stat-title">Contracts</div>
                <div class="stat-subtitle">Pending Your Action</div>
            </div>
            <div class="stat-icon">
                <i class="bi bi-file-earmark-text"></i>
            </div>
        </a>
        
        <a href="{% url 'contracts:approvals' %}" class="stat-card">
            <div class="stat-content">
                <div class="stat-number">{{ pending_approvals.count|default:0 }}</div>
                <div class="stat-title">Additional Approvals</div>
                <div class="stat-subtitle">Pending Your Action</div>
            </div>
            <div class="stat-icon">
                <i class="bi bi-check2-square"></i>
            </div>
        </a>
        
        <a href="{% url 'contracts:list' %}?tab=repository&expiring=true" class="stat-card">
            <div class="stat-content">
                <div class="stat-number">{{ expiring_contracts.count|default:0 }}</div>
                <div class="stat-title">Contracts</div>
                <div class="stat-subtitle">Expiring</div>
            </div>
            <div class="stat-icon">
                <i class="bi bi-calendar-event"></i>
            </div>
        </a>
        
        <a href="{% url 'contracts:list' %}" class="stat-card">
            <div class="stat-content">
                <div class="stat-number">{{ notified_contracts.count|default:0 }}</div>
                <div class="stat-title">Contracts</div>
                <div class="stat-subtitle">Notified</div>
            </div>
            <div class="stat-icon">
                <i class="bi bi-bell"></i>
            </div>
        </a>
    </div>
    
    <!-- Main Content Grid -->
    <div class="content-grid">
        <div class="content-card">
            <div class="content-card-header">
                <h3>Contracts pending your action</h3>
                <a href="{% url 'contracts:list' %}?tab=pending" class="view-all-link">View All</a>
            </div>
            <div class="content-card-body">
                {% if pending_action.contracts %}
                    <div class="w-100">
                        {% for contract in pending_action.contracts|slice:":5" %}
                        <div class="contract-item p-3 border-bottom">
                            <a href="{% url 'contracts:detail' pk=contract.pk %}" class="text-decoration-none">
                                <div class="fw-semibold text-dark">{{ contract.title }}</div>
                                <small class="text-muted">{{ contract.customer_or_vendor_name }} Â· {{ contract.created_at|date:"M d, Y" }}</small>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <span class="empty-state-text">You're all caught up!</span>
                {% endif %}
            </div>
            <div class="content-card-footer">
                <a href="#" class="pagination-link">Previous</a>
                <a href="#" class="pagination-link">Next</a>
            </div>
        </div>
        
        <div class="illustration-card">
            <div class="illustration-placeholder">
                <svg viewBox="0 0 200 160" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Document -->
                    <rect x="60" y="30" width="80" height="100" rx="4" fill="#e8f5e9" stroke="#2ecc71" stroke-width="2"/>
                    <rect x="72" y="50" width="40" height="4" rx="2" fill="#2ecc71" opacity="0.5"/>
                    <rect x="72" y="62" width="56" height="4" rx="2" fill="#2ecc71" opacity="0.3"/>
                    <rect x="72" y="74" width="48" height="4" rx="2" fill="#2ecc71" opacity="0.3"/>
                    <rect x="72" y="86" width="52" height="4" rx="2" fill="#2ecc71" opacity="0.3"/>
                    
                    <!-- Pen -->
                    <g transform="rotate(-45 140 60)">
                        <rect x="130" y="40" width="8" height="50" rx="2" fill="#f39c12"/>
                        <polygon points="130,90 134,100 138,90" fill="#2c3e50"/>
                    </g>
                    
                    <!-- Checkmark -->
                    <circle cx="50" cy="50" r="16" fill="#2ecc71" opacity="0.2"/>
                    <path d="M43 50 L48 55 L57 44" stroke="#2ecc71" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    
                    <!-- Handshake hint -->
                    <circle cx="150" cy="120" r="20" fill="#3498db" opacity="0.1"/>
                    <path d="M140 120 L145 115 L150 120 L155 115 L160 120" stroke="#3498db" stroke-width="2" fill="none" stroke-linecap="round"/>
                    
                    <!-- Stars -->
                    <path d="M170 40 L172 44 L176 44 L173 47 L174 51 L170 48 L166 51 L167 47 L164 44 L168 44 Z" fill="#f39c12" opacity="0.6"/>
                    <path d="M40 100 L41 103 L44 103 L42 105 L43 108 L40 106 L37 108 L38 105 L36 103 L39 103 Z" fill="#3498db" opacity="0.4"/>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- Status Section -->
    <div class="status-section">
        <div class="status-grid">
            <div class="status-card">
                <h4>Contract Status Overview</h4>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot draft"></span>Draft</span>
                    <span class="status-count">{{ contract_stats.draft|default:0 }}</span>
                </div>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot pending"></span>Pending</span>
                    <span class="status-count">{{ contract_stats.pending|default:0 }}</span>
                </div>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot active"></span>Active</span>
                    <span class="status-count">{{ contract_stats.active|default:0 }}</span>
                </div>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot expired"></span>Expired</span>
                    <span class="status-count">{{ contract_stats.expired|default:0 }}</span>
                </div>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot terminated"></span>Terminated</span>
                    <span class="status-count">{{ contract_stats.terminated|default:0 }}</span>
                </div>
                <div class="status-item">
                    <span class="status-label"><span class="status-dot archived"></span>Archived</span>
                    <span class="status-count">{{ contract_stats.archived|default:0 }}</span>
                </div>
                <div class="status-total">
                    <span class="status-label">Total</span>
                    <span class="status-count">{{ contract_stats.total|default:0 }}</span>
                </div>
            </div>
            
            <div class="status-card">
                <h4>Recent Activity</h4>
                {% if recent_activity %}
                    {% for activity in recent_activity|slice:":6" %}
                    <div class="status-item">
                        <span class="status-label">
                            <i class="bi bi-circle-fill" style="font-size: 6px;"></i>
                            {{ activity.action|title }}
                        </span>
                        <span class="status-count text-muted fw-normal" style="font-size: 0.75rem;">{{ activity.created_at|timesince }} ago</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4 text-muted">
                        <small>No recent activity</small>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'contracts/js/contracts.js' %}"></script>
<script>
// Add click interaction for stat cards
document.querySelectorAll('.stat-card').forEach(card => {
    card.addEventListener('click', function(e) {
        document.querySelectorAll('.stat-card').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
    });
});
</script>
{% endblock %}
